# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.

# Tests for array concatenation via concat() function
# The concat() function uses runtime delegation to array concatenation when called with array arguments

# Basic array concatenation
query ?
SELECT concat(make_array(1,2,3), make_array(4,5));
----
[1, 2, 3, 4, 5]

# Multiple array concatenation  
query ?
SELECT concat(make_array(1,2), make_array(3,4), make_array(5,6));
----
[1, 2, 3, 4, 5, 6]

# Array concatenation with nulls
query ?
SELECT concat(make_array(1, NULL, 3), make_array(4));
----
[1, NULL, 3, 4]

# Empty array edge cases 
# Note: These cases fail due to Arrow's limitation with concatenating different array types (Null vs Int64)
# This is consistent with limitations in the underlying array processing library
statement error Arrow error: Invalid argument error: It is not possible to concatenate arrays of different data types
SELECT concat(make_array(), make_array(1,2));

statement error Arrow error: Invalid argument error: It is not possible to concatenate arrays of different data types
SELECT concat(make_array(1,2), make_array());

# Test string arrays
query ?
SELECT concat(make_array('a', 'b'), make_array('c', 'd'));
----
[a, b, c, d]

# Test multi-row array concatenation
statement ok
CREATE TABLE array_table (
  id INT,
  arr1 INT[],
  arr2 INT[]
) AS VALUES
  (1, make_array(1,2), make_array(3,4)),
  (2, make_array(10,20), make_array(30,40));

query I?
SELECT id, concat(arr1, arr2) FROM array_table ORDER BY id;
----
1 [1, 2, 3, 4]
2 [10, 20, 30, 40]

# Mixed type rejection - should produce clear error
statement error Cannot mix array and non-array arguments in concat function
SELECT concat(make_array(1), 'x');

# Test single array concatenation - should work
query ?
SELECT concat(CAST(make_array(1,2) AS INT[]));
----
[1, 2]

# Test null array handling  
query ?
SELECT concat(CAST(NULL AS BIGINT[]), make_array(1,2));
----
[1, 2]

query ?
SELECT concat(make_array(1,2), CAST(NULL AS BIGINT[]));
----
[1, 2]

# Test all null arrays - expect error for now since no valid element type can be determined
statement error No valid arrays to concatenate
SELECT concat(CAST(NULL AS INT[]), CAST(NULL AS INT[]));

# Test large arrays (performance)
query I
SELECT array_length(concat(range(0, 1000), range(1000, 2000)));
----
2000

# Test different numeric types in arrays
query ?
SELECT concat(make_array(1::bigint, 2::bigint), make_array(3::bigint, 4::bigint));
----
[1, 2, 3, 4]

# Test mixed types error with better error message
statement error Cannot mix array and non-array arguments in concat function
SELECT concat(make_array(1), 'hello');

# Test boolean arrays
query ?
SELECT concat(make_array(true, false), make_array(false, true));
----
[true, false, false, true]

# Test float arrays  
query ?
SELECT concat(make_array(1.5, 2.5), make_array(3.5, 4.5));
----
[1.5, 2.5, 3.5, 4.5]

# Clean up
statement ok
DROP TABLE array_table;