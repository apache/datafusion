
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at

#   http://www.apache.org/licenses/LICENSE-2.0

# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.

query TI
select
    s_name,
    count(*) as numwait
from
    supplier,
    lineitem l1,
    orders,
    nation
where
        s_suppkey = l1.l_suppkey
  and o_orderkey = l1.l_orderkey
  and o_orderstatus = 'F'
  and l1.l_receiptdate > l1.l_commitdate
  and exists (
        select
            *
        from
            lineitem l2
        where
                l2.l_orderkey = l1.l_orderkey
          and l2.l_suppkey <> l1.l_suppkey
    )
  and not exists (
        select
            *
        from
            lineitem l3
        where
                l3.l_orderkey = l1.l_orderkey
          and l3.l_suppkey <> l1.l_suppkey
          and l3.l_receiptdate > l3.l_commitdate
    )
  and s_nationkey = n_nationkey
  and n_name = 'SAUDI ARABIA'
group by
    s_name
order by
    numwait desc,
    s_name;
----
Supplier#000000074 167
Supplier#000000496 156
Supplier#000000357 151
Supplier#000000565 151
Supplier#000000380 150
Supplier#000000633 150
Supplier#000000718 149
Supplier#000000167 146
Supplier#000000486 143
Supplier#000000472 142
Supplier#000000821 142
Supplier#000000648 141
Supplier#000000669 139
Supplier#000000602 138
Supplier#000000708 137
Supplier#000000977 137
Supplier#000000144 136
Supplier#000000660 136
Supplier#000000778 135
Supplier#000000825 135
Supplier#000000709 134
Supplier#000000788 133
Supplier#000000918 133
Supplier#000000460 132
Supplier#000000929 132
Supplier#000000114 131
Supplier#000000415 131
Supplier#000000578 131
Supplier#000000445 129
Supplier#000000500 129
Supplier#000000503 129
Supplier#000000889 129
Supplier#000000188 127
Supplier#000000399 126
Supplier#000000610 126
Supplier#000000659 126
Supplier#000000762 126
Supplier#000000920 126
Supplier#000000436 124
Supplier#000000673 124
Supplier#000000262 121
Supplier#000000846 121
Supplier#000000379 120
Supplier#000000670 120
Supplier#000000811 120
Supplier#000000427 113
Supplier#000000687 113
