# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at

# http://www.apache.org/licenses/LICENSE-2.0

# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.

# BigQuery supports the pipe operator syntax
# TODO: Make the Generic dialect support the pipe operator syntax
statement ok
set datafusion.sql_parser.dialect = 'BigQuery';

statement ok
CREATE TABLE test(
    a INT,
    b FLOAT,
    c VARCHAR,
    n VARCHAR
) AS VALUES
  (1, 1.1, 'a', NULL),
  (2, 2.2, 'b', NULL),
  (3, 3.3, 'c', NULL)
;

# WHERE pipe
query IRTT
SELECT *
FROM test
|> WHERE a > 1
----
2 2.2 b NULL
3 3.3 c NULL

# ORDER BY pipe
query IRTT
SELECT *
FROM test
|> ORDER BY a DESC
----
3 3.3 c NULL
2 2.2 b NULL
1 1.1 a NULL

# ORDER BY pipe, limit
query IRTT
SELECT *
FROM test
|> ORDER BY a DESC
|> LIMIT 1
----
3 3.3 c NULL

# SELECT pipe
query I
SELECT *
FROM test
|> SELECT a
----
1
2
3

# EXTEND pipe
query IRR
SELECT *
FROM test
|> SELECT a, b
|> EXTEND a + b AS a_plus_b
----
1 1.1 2.1
2 2.2 4.2
3 3.3 6.3

query IRR
SELECT *
FROM test
|> SELECT a, b
|> where a = 1
|> EXTEND a + b AS a_plus_b
----
1 1.1 2.1
