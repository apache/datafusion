# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.

# This file is intended to be run with tables already defined
# with standard values, but different types in string columns
# (String, StringView, etc.)

# select
query TTTT
SELECT ascii_1, ascii_2, unicode_1, unicode_2 FROM test_basic_operator
----
Andrew X datafusionğŸ“ŠğŸ”¥ ğŸ”¥
Xiangpeng Xiangpeng datafusionæ•°æ®èåˆ datafusionæ•°æ®èåˆ
Raphael R datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½ Ğ°Ğ¤ÑƒÑ
NULL R NULL ğŸ”¥

# --------------------------------------
# column comparison as filters
# --------------------------------------

query TT
select ascii_1, ascii_2 from test_basic_operator where ascii_1 = ascii_2
----
Xiangpeng Xiangpeng

query TT
select ascii_1, ascii_2 from test_basic_operator where ascii_1 <> ascii_2
----
Andrew X
Raphael R

query TT
select unicode_1, unicode_2 from test_basic_operator where unicode_1 = unicode_2
----
datafusionæ•°æ®èåˆ datafusionæ•°æ®èåˆ

query TT
select unicode_1, unicode_2 from test_basic_operator where unicode_1 <> unicode_2
----
datafusionğŸ“ŠğŸ”¥ ğŸ”¥
datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½ Ğ°Ğ¤ÑƒÑ

query TT
select ascii_1, unicode_1 from test_basic_operator where ascii_1 = unicode_1
----

query TT
select ascii_1, unicode_1 from test_basic_operator where ascii_1 <> unicode_1
----
Andrew datafusionğŸ“ŠğŸ”¥
Xiangpeng datafusionæ•°æ®èåˆ
Raphael datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½

# --------------------------------------
# column comparison
# --------------------------------------
query TTTTBBBBBB
select
    ascii_1, ascii_2, unicode_1, unicode_2,
    ascii_1 = ascii_2,
    ascii_1 <> ascii_2,
    unicode_1 = unicode_2,
    unicode_1 <> unicode_2,
    ascii_1 = unicode_1,
    ascii_1 <> unicode_1
from test_basic_operator;
----
Andrew X datafusionğŸ“ŠğŸ”¥ ğŸ”¥ false true false true false true
Xiangpeng Xiangpeng datafusionæ•°æ®èåˆ datafusionæ•°æ®èåˆ true false true false false true
Raphael R datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½ Ğ°Ğ¤ÑƒÑ false true false true false true
NULL R NULL ğŸ”¥ NULL NULL NULL NULL NULL NULL

# --------------------------------------
# column to StringView scalar comparison
# --------------------------------------
query TTBBBB
select
    ascii_1, unicode_1,
    ascii_1 = arrow_cast('Andrew', 'Utf8View'),
    ascii_1 <> arrow_cast('Andrew', 'Utf8View'),
    unicode_1 = arrow_cast('datafusionæ•°æ®èåˆ', 'Utf8View'),
    unicode_1 <> arrow_cast('datafusionæ•°æ®èåˆ', 'Utf8View')
from test_basic_operator;
----
Andrew datafusionğŸ“ŠğŸ”¥ true false false true
Xiangpeng datafusionæ•°æ®èåˆ false true true false
Raphael datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½ false true false true
NULL NULL NULL NULL NULL NULL

# --------------------------------------
# column to String scalar
# --------------------------------------
query TTBBBB
select
    ascii_1, unicode_1,
    ascii_1 = arrow_cast('Andrew', 'Utf8'),
    ascii_1 <> arrow_cast('Andrew', 'Utf8'),
    unicode_1 = arrow_cast('datafusionæ•°æ®èåˆ', 'Utf8'),
    unicode_1 <> arrow_cast('datafusionæ•°æ®èåˆ', 'Utf8')
from test_basic_operator;
----
Andrew datafusionğŸ“ŠğŸ”¥ true false false true
Xiangpeng datafusionæ•°æ®èåˆ false true true false
Raphael datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½ false true false true
NULL NULL NULL NULL NULL NULL

# --------------------------------------
# column to LargeString scalar
# --------------------------------------
query TTBBBB
select
    ascii_1, unicode_1,
    ascii_1 = arrow_cast('Andrew', 'LargeUtf8'),
    ascii_1 <> arrow_cast('Andrew', 'LargeUtf8'),
    unicode_1 = arrow_cast('datafusionæ•°æ®èåˆ', 'LargeUtf8'),
    unicode_1 <> arrow_cast('datafusionæ•°æ®èåˆ', 'LargeUtf8')
from test_basic_operator;
----
Andrew datafusionğŸ“ŠğŸ”¥ true false false true
Xiangpeng datafusionæ•°æ®èåˆ false true true false
Raphael datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½ false true false true
NULL NULL NULL NULL NULL NULL

# --------------------------------------
# substr function
# --------------------------------------

query TTTTTTTTTTTTTT
select
    substr(c1, 1),
    substr(c1, 3),
    substr(c1, 100),
    substr(c1, -1),
    substr(c1, 0, 0),
    substr(c1, -1, 2),
    substr(c1, -2, 10),
    substr(c1, -100, 200),
    substr(c1, -10, 10),
    substr(c1, -100, 10),
    substr(c1, 1, 100),
    substr(c1, 5, 3),
    substr(c1, 100, 200),
    substr(c1, 8, 0)
from test_substr;
----
foo o (empty) foo (empty) (empty) foo foo (empty) (empty) foo (empty) (empty) (empty)
helloğŸŒä¸–ç•Œ lloğŸŒä¸–ç•Œ (empty) helloğŸŒä¸–ç•Œ (empty) (empty) helloğŸŒä¸– helloğŸŒä¸–ç•Œ (empty) (empty) helloğŸŒä¸–ç•Œ oğŸŒä¸– (empty) (empty)
ğŸ’© (empty) (empty) ğŸ’© (empty) (empty) ğŸ’© ğŸ’© (empty) (empty) ğŸ’© (empty) (empty) (empty)
ThisIsAVeryLongASCIIString isIsAVeryLongASCIIString (empty) ThisIsAVeryLongASCIIString (empty) (empty) ThisIsA ThisIsAVeryLongASCIIString (empty) (empty) ThisIsAVeryLongASCIIString IsA (empty) (empty)
(empty) (empty) (empty) (empty) (empty) (empty) (empty) (empty) (empty) (empty) (empty) (empty) (empty) (empty)
NULL NULL NULL NULL NULL NULL NULL NULL NULL NULL NULL NULL NULL NULL

query TTTT
SELECT
  SUBSTR(ascii_1, 1, 3) as c1,
  SUBSTR(ascii_2, 1, 3) as c2,
  SUBSTR(unicode_1, 1, 3) as c3,
  SUBSTR(unicode_2, 1, 3) as c4
FROM test_basic_operator;
----
And X dat ğŸ”¥
Xia Xia dat dat
Rap R dat Ğ°Ğ¤Ñƒ
NULL R NULL ğŸ”¥

# --------------------------------------
# test distinct aggregate
# --------------------------------------
query II
SELECT
    COUNT(DISTINCT ascii_1),
    COUNT(DISTINCT unicode_1)
FROM
    test_basic_operator
----
3 3

query II
SELECT
    COUNT(DISTINCT ascii_1),
    COUNT(DISTINCT unicode_1)
FROM
    test_basic_operator
GROUP BY ascii_2;
----
1 1
1 1
1 1

query II
SELECT
    COUNT(DISTINCT ascii_1),
    COUNT(DISTINCT unicode_1)
FROM
    test_basic_operator
GROUP BY unicode_2;
----
1 1
1 1
1 1

# --------------------------------------
# STARTS_WITH function
# --------------------------------------

query BBBB
SELECT
    STARTS_WITH(ascii_1, ascii_2),
    STARTS_WITH(unicode_1, unicode_2),
    STARTS_WITH(ascii_1, unicode_2),
    STARTS_WITH(unicode_1, ascii_2)
FROM test_basic_operator
----
false false false false
true true false false
true false false false
NULL NULL NULL NULL

query BBBB
SELECT
    STARTS_WITH(ascii_1, 'And'),
    STARTS_WITH(ascii_2, 'And'),
    STARTS_WITH(unicode_1, 'data'),
    STARTS_WITH(unicode_2, 'data')
FROM test_basic_operator
----
true false true false
false false true true
false false true false
NULL false NULL false

# --------------------------------------
# Test TRANSLATE
# --------------------------------------

query T
SELECT
  TRANSLATE(ascii_1, 'foo', 'bar') as c
FROM test_basic_operator;
----
Andrew
Xiangpeng
Raphael
NULL

query T
SELECT
  TRANSLATE(unicode_1, 'foo', 'bar') as c
FROM test_basic_operator;
----
databusirnğŸ“ŠğŸ”¥
databusirnæ•°æ®èåˆ
databusirnĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½
NULL

# --------------------------------------
# Test REGEXP_REPLACE
# --------------------------------------

# Should run REGEXP_REPLACE with Scalar value for string
query T
SELECT
  REGEXP_REPLACE(ascii_1, 'e', 'f') AS k
FROM test_basic_operator;
----
Andrfw
Xiangpfng
Raphafl
NULL

# Should run REGEXP_REPLACE with Scalar value for string with flag
query T
SELECT
  REGEXP_REPLACE(ascii_1, 'e', 'f', 'i') AS k
FROM test_basic_operator;
----
Andrfw
Xiangpfng
Raphafl
NULL

# Should run REGEXP_REPLACE with ScalarArray value for string
query T
SELECT
  REGEXP_REPLACE(ascii_1, lower(ascii_1), 'bar') AS k
FROM test_basic_operator;
----
Andrew
Xiangpeng
Raphael
NULL

# Should run REGEXP_REPLACE with ScalarArray value for string with flag
query T
SELECT
  REGEXP_REPLACE(ascii_1, lower(ascii_1), 'bar', 'g') AS k
FROM test_basic_operator;
----
Andrew
Xiangpeng
Raphael
NULL

# --------------------------------------
# Test Initcap
# --------------------------------------
statement ok
CREATE TABLE test_lowercase AS SELECT
  lower(ascii_1) as ascii_1_lower,
  lower(unicode_1) as unicode_1_lower
FROM test_basic_operator;

query TT
SELECT
  INITCAP(ascii_1_lower) as c1,
  INITCAP(unicode_1_lower) as c2
FROM test_lowercase;
----
Andrew DatafusionğŸ“ŠğŸ”¥
Xiangpeng Datafusionæ•°æ®èåˆ
Raphael DatafusionĞ´Ğ°Ñ‚Ğ°Ñ„ÑƒÑĞ¸Ğ¾Ğ½
NULL NULL

statement ok
drop table test_lowercase;

# --------------------------------------
# Test ASCII
# --------------------------------------

query IIII
SELECT
  ASCII(ascii_1) as c1,
  ASCII(ascii_2) as c2,
  ASCII(unicode_1) as c3,
  ASCII(unicode_2) as c4
FROM test_basic_operator;
----
65 88 100 128293
88 88 100 100
82 82 100 1072
NULL 82 NULL 128293

# --------------------------------------
# Test BTRIM
# --------------------------------------

# Test BTRIM outputs
query TTTTTT
SELECT
  BTRIM(ascii_1, 'foo'),
  BTRIM(ascii_1, 'A'),
  BTRIM(ascii_1, NULL),
  BTRIM(unicode_1),
  BTRIM(unicode_1, 'ğŸ”¥'),
  BTRIM(unicode_1, NULL)
FROM test_basic_operator;
----
Andrew ndrew NULL datafusionğŸ“ŠğŸ”¥ datafusionğŸ“Š NULL
Xiangpeng Xiangpeng NULL datafusionæ•°æ®èåˆ datafusionæ•°æ®èåˆ NULL
Raphael Raphael NULL datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½ datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½ NULL
NULL NULL NULL NULL NULL NULL

# --------------------------------------
# Test LTRIM
# --------------------------------------

# Test LTRIM outputs
query TTTTTT
SELECT
  LTRIM(ascii_1, 'foo'),
  LTRIM(ascii_1, ascii_2),
  LTRIM(ascii_1, NULL),
  LTRIM(unicode_1),
  LTRIM(unicode_1, NULL),
  LTRIM(unicode_1, 'ğŸ”¥')
FROM test_basic_operator;
----
Andrew Andrew NULL datafusionğŸ“ŠğŸ”¥ NULL datafusionğŸ“ŠğŸ”¥
Xiangpeng (empty) NULL datafusionæ•°æ®èåˆ NULL datafusionæ•°æ®èåˆ
Raphael aphael NULL datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½ NULL datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½
NULL NULL NULL NULL NULL NULL

# --------------------------------------
# Test RTRIM
# --------------------------------------

# Test RTRIM outputs
query TTTTT
SELECT
  RTRIM(ascii_1, 'rew'),
  RTRIM(ascii_1, ascii_2),
  RTRIM(ascii_1),
  RTRIM(unicode_1, NULL),
  RTRIM(unicode_1, 'ğŸ”¥')
FROM test_basic_operator;
----
And Andrew Andrew NULL datafusionğŸ“Š
Xiangpeng (empty) Xiangpeng NULL datafusionæ•°æ®èåˆ
Raphael Raphael Raphael NULL datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½
NULL NULL NULL NULL NULL

# --------------------------------------
# Test CONTAINS
# --------------------------------------

query BBBBBB
SELECT
  CONTAINS(ascii_1, 'foo') as c1,
  CONTAINS(ascii_1, ascii_2) as c2,
  CONTAINS(ascii_1, NULL) as c3,
  CONTAINS(unicode_1, unicode_2) as c4,
  CONTAINS(unicode_1, NULL) as c5,
  CONTAINS(unicode_1, 'ğŸ”¥') as c6
FROM test_basic_operator;
----
false false NULL true NULL true
false true NULL true NULL false
false true NULL true NULL false
NULL NULL NULL NULL NULL NULL

# --------------------------------------
# Test LOWER
# --------------------------------------

query TT
SELECT LOWER(ascii_1) as c1, LOWER(unicode_1) as c2 FROM test_basic_operator;
----
andrew datafusionğŸ“ŠğŸ”¥
xiangpeng datafusionæ•°æ®èåˆ
raphael datafusionĞ´Ğ°Ñ‚Ğ°Ñ„ÑƒÑĞ¸Ğ¾Ğ½
NULL NULL

# --------------------------------------
# Test UPPER
# --------------------------------------

query TT
SELECT UPPER(ascii_1) as c1, UPPER(unicode_1) as c2 FROM test_basic_operator;
----
ANDREW DATAFUSIONğŸ“ŠğŸ”¥
XIANGPENG DATAFUSIONæ•°æ®èåˆ
RAPHAEL DATAFUSIONĞ”ĞĞ¢ĞĞ¤Ğ£Ğ¡Ğ˜ĞĞ
NULL NULL

# --------------------------------------
# Test Concat
# --------------------------------------

query TTTTTTTTTTTT
SELECT
    concat(ascii_1, ':Data'),
    concat(ascii_1, ascii_2),
    concat(ascii_1, NULL),
    concat(ascii_1, unicode_1),
    concat(ascii_1, unicode_2),
    concat(unicode_1, ascii_1),
    concat(unicode_1, unicode_2),
    concat(unicode_1, NULL),
    concat(unicode_1, 'ğŸ”¥'),
    concat(NULL, 'ğŸ”¥'),
    concat(NULL, NULL),
    concat(ascii_1, ',', unicode_1)
FROM test_basic_operator;
----
Andrew:Data AndrewX Andrew AndrewdatafusionğŸ“ŠğŸ”¥ AndrewğŸ”¥ datafusionğŸ“ŠğŸ”¥Andrew datafusionğŸ“ŠğŸ”¥ğŸ”¥ datafusionğŸ“ŠğŸ”¥ datafusionğŸ“ŠğŸ”¥ğŸ”¥ ğŸ”¥ (empty) Andrew,datafusionğŸ“ŠğŸ”¥
Xiangpeng:Data XiangpengXiangpeng Xiangpeng Xiangpengdatafusionæ•°æ®èåˆ Xiangpengdatafusionæ•°æ®èåˆ datafusionæ•°æ®èåˆXiangpeng datafusionæ•°æ®èåˆdatafusionæ•°æ®èåˆ datafusionæ•°æ®èåˆ datafusionæ•°æ®èåˆğŸ”¥ ğŸ”¥ (empty) Xiangpeng,datafusionæ•°æ®èåˆ
Raphael:Data RaphaelR Raphael RaphaeldatafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½ RaphaelĞ°Ğ¤ÑƒÑ datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½Raphael datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½Ğ°Ğ¤ÑƒÑ datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½ datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½ğŸ”¥ ğŸ”¥ (empty) Raphael,datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½
:Data R (empty) (empty) ğŸ”¥ (empty) ğŸ”¥ (empty) ğŸ”¥ ğŸ”¥ (empty) ,

# --------------------------------------
# Test OVERLAY
# --------------------------------------

query TTTTTT
SELECT
    OVERLAY(ascii_1 PLACING 'foo' FROM 2 ),
    OVERLAY(unicode_1 PLACING 'foo' FROM 2),
    OVERLAY(ascii_1 PLACING 'ğŸ”¥' FROM 2),
    OVERLAY(unicode_1 PLACING 'ğŸ”¥' FROM 2),
    OVERLAY(ascii_1 PLACING NULL FROM 2),
    OVERLAY(unicode_1 PLACING NULL FROM 2)
FROM test_basic_operator;
----
Afooew dfoofusionğŸ“ŠğŸ”¥ AğŸ”¥drew dğŸ”¥tafusionğŸ“ŠğŸ”¥ NULL NULL
Xfoogpeng dfoofusionæ•°æ®èåˆ XğŸ”¥angpeng dğŸ”¥tafusionæ•°æ®èåˆ NULL NULL
Rfooael dfoofusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½ RğŸ”¥phael dğŸ”¥tafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½ NULL NULL
NULL NULL NULL NULL NULL NULL

# --------------------------------------
# Test REPLACE
# --------------------------------------

query TTTTTT
SELECT
  REPLACE(ascii_1, 'foo', 'bar'),
  REPLACE(ascii_1, ascii_2, 'bar'),
  REPLACE(ascii_1, NULL, 'bar'),
  REPLACE(unicode_1, unicode_2, 'bar'),
  REPLACE(unicode_1, NULL, 'bar'),
  REPLACE(unicode_1, 'ğŸ”¥', 'bar')
FROM test_basic_operator;
----
Andrew Andrew NULL datafusionğŸ“Šbar NULL datafusionğŸ“Šbar
Xiangpeng bar NULL bar NULL datafusionæ•°æ®èåˆ
Raphael baraphael NULL datafusionĞ”Ğ°Ñ‚barĞ¸Ğ¾Ğ½ NULL datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½
NULL NULL NULL NULL NULL NULL

# --------------------------------------
# Test RIGHT
# --------------------------------------
# Test outputs of RIGHT
query TTTTTT
SELECT
  RIGHT(ascii_1, 3),
  RIGHT(ascii_1, 0),
  RIGHT(ascii_1, -3),
  RIGHT(unicode_1, 3),
  RIGHT(unicode_1, 0),
  RIGHT(unicode_1, -3)
FROM test_basic_operator;
----
rew (empty) rew nğŸ“ŠğŸ”¥ (empty) afusionğŸ“ŠğŸ”¥
eng (empty) ngpeng æ®èåˆ (empty) afusionæ•°æ®èåˆ
ael (empty) hael Ğ¸Ğ¾Ğ½ (empty) afusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½
NULL NULL NULL NULL NULL NULL

# --------------------------------------
# Test LEFT
# --------------------------------------

# Test outputs of LEFT
query TTTTTT
SELECT
  LEFT(ascii_1, 3),
  LEFT(ascii_1, 0),
  LEFT(ascii_1, -3),
  LEFT(unicode_1, 3),
  LEFT(unicode_1, 0),
  LEFT(unicode_1, -3)
FROM test_basic_operator;
----
And (empty) And dat (empty) datafusio
Xia (empty) Xiangp dat (empty) datafusionæ•°
Rap (empty) Raph dat (empty) datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑ
NULL NULL NULL NULL NULL NULL

# --------------------------------------
# Test SUBSTR_INDEX
# --------------------------------------

query TTTT
SELECT
  SUBSTR_INDEX(ascii_1, 'a', 1),
  SUBSTR_INDEX(ascii_1, 'a', 2),
  SUBSTR_INDEX(unicode_1, 'Ğ°', 1),
  SUBSTR_INDEX(unicode_1, 'Ğ°', 2)
FROM test_basic_operator;
----
Andrew Andrew datafusionğŸ“ŠğŸ”¥ datafusionğŸ“ŠğŸ”¥
Xi Xiangpeng datafusionæ•°æ®èåˆ datafusionæ•°æ®èåˆ
R Raph datafusionĞ” datafusionĞ”Ğ°Ñ‚
NULL NULL NULL NULL

# --------------------------------------
# Test FIND_IN_SET
# --------------------------------------

query IIII
SELECT
  FIND_IN_SET(ascii_1, 'a,b,c,d'),
  FIND_IN_SET(ascii_1, 'Andrew,Xiangpeng,Raphael'),
  FIND_IN_SET(unicode_1, 'a,b,c,d'),
  FIND_IN_SET(unicode_1, 'datafusionğŸ“ŠğŸ”¥,datafusionæ•°æ®èåˆ,datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½')
FROM test_basic_operator;
----
0 1 0 1
0 2 0 2
0 3 0 3
NULL NULL NULL NULL

# --------------------------------------
# Test || operator
# --------------------------------------

# || constants
# expect all results to be the same for each row as they all have the same values
query TTTT
SELECT
    ascii_1 || 'foo',
    ascii_1 || 'ğŸ”¥',
    unicode_1 || 'foo',
    unicode_1 || 'ğŸ”¥'
FROM test_basic_operator;
----
Andrewfoo AndrewğŸ”¥ datafusionğŸ“ŠğŸ”¥foo datafusionğŸ“ŠğŸ”¥ğŸ”¥
Xiangpengfoo XiangpengğŸ”¥ datafusionæ•°æ®èåˆfoo datafusionæ•°æ®èåˆğŸ”¥
Raphaelfoo RaphaelğŸ”¥ datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½foo datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½ğŸ”¥
NULL NULL NULL NULL

# || same type (column1 has null, so also tests NULL || NULL)
# expect all results to be the same for each row as they all have the same values
query TTTT
SELECT
    ascii_1 || ascii_2,
    ascii_1 || unicode_2,
    unicode_1 || ascii_2,
    unicode_1 || unicode_2
FROM test_basic_operator;
----
AndrewX AndrewğŸ”¥ datafusionğŸ“ŠğŸ”¥X datafusionğŸ“ŠğŸ”¥ğŸ”¥
XiangpengXiangpeng Xiangpengdatafusionæ•°æ®èåˆ datafusionæ•°æ®èåˆXiangpeng datafusionæ•°æ®èåˆdatafusionæ•°æ®èåˆ
RaphaelR RaphaelĞ°Ğ¤ÑƒÑ datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½R datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½Ğ°Ğ¤ÑƒÑ
NULL NULL NULL NULL

# --------------------------------------
# Test ~ operator
# --------------------------------------

query BB
SELECT
  ascii_1 ~ 'an',
  unicode_1 ~ 'Ñ‚Ğ°Ğ¤'
FROM test_basic_operator;
----
false false
true false
false true
NULL NULL

# TODO: DictionaryString does not support ~* operator. Enable this after fixing the issue
# see issue: https://github.com/apache/datafusion/issues/12618
#query BB
#SELECT
#  ascii_1 ~* '^a.{3}e',
#  unicode_1 ~* '^d.*Ğ¤Ñƒ'
#FROM test_basic_operator;
#----
#true false
#false false
#false true
#NULL NULL

query BB
SELECT
  ascii_1 !~~ 'xia_g%g',
  unicode_1 !~~ 'datafusionæ•°æ®èåˆ'
FROM test_basic_operator;
----
true true
true false
true true
NULL NULL

query BB
SELECT
  ascii_1 !~~* 'xia_g%g',
  unicode_1 !~~* 'datafusionæ•°æ®èåˆ'
FROM test_basic_operator;
----
true true
false false
true true
NULL NULL

# --------------------------------------
# Test || operator
# --------------------------------------

query TTTTT
select
    ascii_1 || ' nice',
    ascii_1 || ' and ' || ascii_2,
    unicode_1 || ' cool',
    unicode_1 || ' and ' || unicode_2,
    ascii_1 || ' ğŸ”¥ ' || unicode_1
from test_basic_operator;
----
Andrew nice Andrew and X datafusionğŸ“ŠğŸ”¥ cool datafusionğŸ“ŠğŸ”¥ and ğŸ”¥ Andrew ğŸ”¥ datafusionğŸ“ŠğŸ”¥
Xiangpeng nice Xiangpeng and Xiangpeng datafusionæ•°æ®èåˆ cool datafusionæ•°æ®èåˆ and datafusionæ•°æ®èåˆ Xiangpeng ğŸ”¥ datafusionæ•°æ®èåˆ
Raphael nice Raphael and R datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½ cool datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½ and Ğ°Ğ¤ÑƒÑ Raphael ğŸ”¥ datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½
NULL NULL NULL NULL NULL

# --------------------------------------
# Test LIKE / ILIKE
# --------------------------------------

# TODO: StringView has wrong behavior for LIKE/ILIKE. Enable this after fixing the issue
# see issue: https://github.com/apache/datafusion/issues/12637
# Test pattern with wildcard characters
#query TTBBBB
#select ascii_1, unicode_1,
#       ascii_1 like 'An%' as ascii_like,
#       unicode_1 like '%ionæ•°æ®%' as unicode_like,
#       ascii_1 ilike 'An%' as ascii_ilike,
#       unicode_1 ilike '%ionæ•°æ®%' as unicode_ilik
#from test_basic_operator;
#----
#Andrew datafusionğŸ“ŠğŸ”¥ true false true false
#Xiangpeng datafusionæ•°æ®èåˆ false true false true
#Raphael datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½ false false false false
#NULL NULL NULL NULL NULL NULL

# Test pattern without wildcard characters
query TTBBBB
select ascii_1, unicode_1,
       ascii_1 like 'An' as ascii_like,
       unicode_1 like 'ionæ•°æ®' as unicode_like,
       ascii_1 ilike 'An' as ascii_ilike,
       unicode_1 ilike 'ionæ•°æ®' as unicode_ilik
from test_basic_operator;
----
Andrew datafusionğŸ“ŠğŸ”¥ false false false false
Xiangpeng datafusionæ•°æ®èåˆ false false false false
Raphael datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½ false false false false
NULL NULL NULL NULL NULL NULL

# --------------------------------------
# Test CHARACTER_LENGTH
# --------------------------------------

query II
SELECT
  CHARACTER_LENGTH(ascii_1),
  CHARACTER_LENGTH(unicode_1)
FROM
    test_basic_operator
----
6 12
9 14
7 20
NULL NULL

# --------------------------------------
# Test Start_With
# --------------------------------------

query BBBB
SELECT
  STARTS_WITH(ascii_1, 'And'),
  STARTS_WITH(unicode_1, 'data'),
  STARTS_WITH(ascii_1, NULL),
  STARTS_WITH(unicode_1, NULL)
FROM test_basic_operator;
----
true true NULL NULL
false true NULL NULL
false true NULL NULL
NULL NULL NULL NULL

# --------------------------------------
# Test ENDS_WITH
# --------------------------------------

query BBBB
SELECT
  ENDS_WITH(ascii_1, 'w'),
  ENDS_WITH(unicode_1, 'Ğ¸Ğ¾Ğ½'),
  ENDS_WITH(ascii_1, NULL),
  ENDS_WITH(unicode_1, NULL)
FROM test_basic_operator;
----
true false NULL NULL
false false NULL NULL
false true NULL NULL
NULL NULL NULL NULL

# --------------------------------------
# Test LEVENSHTEIN
# --------------------------------------

query IIII
SELECT
  LEVENSHTEIN(ascii_1, 'Andrew'),
  LEVENSHTEIN(unicode_1, 'datafusionæ•°æ®èåˆ'),
  LEVENSHTEIN(ascii_1, NULL),
  LEVENSHTEIN(unicode_1, NULL)
FROM test_basic_operator;
----
0 4 NULL NULL
7 0 NULL NULL
6 10 NULL NULL
NULL NULL NULL NULL

# --------------------------------------
# Test LPAD
# --------------------------------------

query TTTT
SELECT
  LPAD(ascii_1, 20, 'x'),
  LPAD(ascii_1, 20, NULL),
  LPAD(unicode_1, 20, 'ğŸ”¥'),
  LPAD(unicode_1, 20, NULL)
FROM test_basic_operator;
----
xxxxxxxxxxxxxxAndrew NULL ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥datafusionğŸ“ŠğŸ”¥ NULL
xxxxxxxxxxxXiangpeng NULL ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥datafusionæ•°æ®èåˆ NULL
xxxxxxxxxxxxxRaphael NULL datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½ NULL
NULL NULL NULL NULL

query TT
SELECT
  LPAD(ascii_1, 20),
  LPAD(unicode_1, 20)
FROM test_basic_operator;
----
              Andrew         datafusionğŸ“ŠğŸ”¥
           Xiangpeng       datafusionæ•°æ®èåˆ
             Raphael datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½
NULL NULL

# --------------------------------------
# Test RPAD
# --------------------------------------

query TTTT
SELECT
  RPAD(ascii_1, 20, 'x'),
  RPAD(ascii_1, 20, NULL),
  RPAD(unicode_1, 20, 'ğŸ”¥'),
  RPAD(unicode_1, 20, NULL)
FROM test_basic_operator;
----
Andrewxxxxxxxxxxxxxx NULL datafusionğŸ“ŠğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ NULL
Xiangpengxxxxxxxxxxx NULL datafusionæ•°æ®èåˆğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ NULL
Raphaelxxxxxxxxxxxxx NULL datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½ NULL
NULL NULL NULL NULL

query TT
SELECT
  RPAD(ascii_1, 20),
  RPAD(unicode_1, 20)
FROM test_basic_operator;
----
Andrew              datafusionğŸ“ŠğŸ”¥
Xiangpeng           datafusionæ•°æ®èåˆ
Raphael             datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½
NULL NULL

# --------------------------------------
# Test REGEXP_LIKE
# --------------------------------------

query BBBBBBBB
SELECT
  -- without flags
  REGEXP_LIKE(ascii_1, 'an'),
  REGEXP_LIKE(unicode_1, 'Ñ‚Ğ°Ğ¤'),
  REGEXP_LIKE(ascii_1, NULL),
  REGEXP_LIKE(unicode_1, NULL),
  -- with flags
  REGEXP_LIKE(ascii_1, 'AN', 'i'),
  REGEXP_LIKE(unicode_1, 'Ğ¢Ğ°Ğ¤', 'i'),
  REGEXP_LIKE(ascii_1, NULL, 'i'),
  REGEXP_LIKE(unicode_1, NULL, 'i')
  FROM test_basic_operator;
----
false false NULL NULL true false NULL NULL
true false NULL NULL true false NULL NULL
false true NULL NULL false true NULL NULL
NULL NULL NULL NULL NULL NULL NULL NULL

# --------------------------------------
# Test REGEXP_MATCH
# --------------------------------------

query ????????
SELECT
  -- without flags
  REGEXP_MATCH(ascii_1, 'an'),
  REGEXP_MATCH(unicode_1, 'Ğ¢Ğ°Ğ¤'),
  REGEXP_MATCH(ascii_1, NULL),
  REGEXP_MATCH(unicode_1, NULL),
  -- with flags
  REGEXP_MATCH(ascii_1, 'AN', 'i'),
  REGEXP_MATCH(unicode_1, 'Ñ‚Ğ°Ğ¤', 'i'),
  REGEXP_MATCH(ascii_1, NULL, 'i'),
  REGEXP_MATCH(unicode_1, NULL, 'i')
FROM test_basic_operator;
----
NULL NULL NULL NULL [An] NULL NULL NULL
[an] NULL NULL NULL [an] NULL NULL NULL
NULL NULL NULL NULL NULL [Ñ‚Ğ°Ğ¤] NULL NULL
NULL NULL NULL NULL NULL NULL NULL NULL

# --------------------------------------
# Test REPEAT
# --------------------------------------

query TT
SELECT
  REPEAT(ascii_1, 3),
  REPEAT(unicode_1, 3)
FROM test_basic_operator;
----
AndrewAndrewAndrew datafusionğŸ“ŠğŸ”¥datafusionğŸ“ŠğŸ”¥datafusionğŸ“ŠğŸ”¥
XiangpengXiangpengXiangpeng datafusionæ•°æ®èåˆdatafusionæ•°æ®èåˆdatafusionæ•°æ®èåˆ
RaphaelRaphaelRaphael datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½
NULL NULL

# --------------------------------------
# Test SPLIT_PART
# --------------------------------------

query TTTTTT
SELECT
  SPLIT_PART(ascii_1, 'e', 1),
  SPLIT_PART(ascii_1, 'e', 2),
  SPLIT_PART(ascii_1, NULL, 1),
  SPLIT_PART(unicode_1, 'Ğ¸', 1),
  SPLIT_PART(unicode_1, 'Ğ¸', 2),
  SPLIT_PART(unicode_1, NULL, 1)
FROM test_basic_operator;
----
Andr w NULL datafusionğŸ“ŠğŸ”¥ (empty) NULL
Xiangp ng NULL datafusionæ•°æ®èåˆ (empty) NULL
Rapha l NULL datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑ Ğ¾Ğ½ NULL
NULL NULL NULL NULL NULL NULL

# --------------------------------------
# Test REVERSE
# --------------------------------------

query TT
SELECT
  REVERSE(ascii_1),
  REVERSE(unicode_1)
FROM test_basic_operator;
----
werdnA ğŸ”¥ğŸ“Šnoisufatad
gnepgnaiX åˆèæ®æ•°noisufatad
leahpaR Ğ½Ğ¾Ğ¸ÑÑƒĞ¤Ğ°Ñ‚Ğ°Ğ”noisufatad
NULL NULL

# --------------------------------------
# Test STRPOS
# --------------------------------------

query IIIIII
SELECT
  STRPOS(ascii_1, 'e'),
  STRPOS(ascii_1, 'ang'),
  STRPOS(ascii_1, NULL),
  STRPOS(unicode_1, 'Ğ¸'),
  STRPOS(unicode_1, 'Ğ¸Ğ¾Ğ½'),
  STRPOS(unicode_1, NULL)
FROM test_basic_operator;
----
5 0 NULL 0 0 NULL
7 3 NULL 0 0 NULL
6 0 NULL 18 18 NULL
NULL NULL NULL NULL NULL NULL

# --------------------------------------
# Test SUBSTR_INDEX
# --------------------------------------

query TTTTTT
SELECT
  SUBSTR_INDEX(ascii_1, 'e', 1),
  SUBSTR_INDEX(ascii_1, 'ang', 1),
  SUBSTR_INDEX(ascii_1, NULL, 1),
  SUBSTR_INDEX(unicode_1, 'Ğ¸', 1),
  SUBSTR_INDEX(unicode_1, 'æ®è', 1),
  SUBSTR_INDEX(unicode_1, NULL, 1)
FROM test_basic_operator;
----
Andr Andrew NULL datafusionğŸ“ŠğŸ”¥ datafusionğŸ“ŠğŸ”¥ NULL
Xiangp Xi NULL datafusionæ•°æ®èåˆ datafusionæ•° NULL
Rapha Raphael NULL datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑ datafusionĞ”Ğ°Ñ‚Ğ°Ğ¤ÑƒÑĞ¸Ğ¾Ğ½ NULL
NULL NULL NULL NULL NULL NULL
