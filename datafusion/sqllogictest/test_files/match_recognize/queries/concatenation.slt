# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.

# Import common test data
include ../init_data.slt.part

# Test 1: Basic concatenation pattern (A B C)
query TDI
SELECT * FROM stock_price
MATCH_RECOGNIZE (
    ALL ROWS PER MATCH
    PATTERN (A B C)
    DEFINE
        A AS price > 100,
        B AS price < 130,
        C AS price > 130
)
----
DDOG 2024-01-01 125
DDOG 2024-01-02 128
DDOG 2024-01-03 132

# Test 2: Two symbol concatenation (A B)
query TDI
SELECT * FROM stock_price
MATCH_RECOGNIZE (
    ALL ROWS PER MATCH
    PATTERN (A B)
    DEFINE
        A AS price > 100,
        B AS price < 130
)
----
DDOG 2024-01-01 125
DDOG 2024-01-02 128
DDOG 2024-01-03 132
DDOG 2024-01-04 129

# Test 3: Pattern with no matches
query TDI
SELECT * FROM stock_price
MATCH_RECOGNIZE (
    ALL ROWS PER MATCH
    PATTERN (A B C)
    DEFINE
        A AS price > 100,
        B AS price < 50,
        C AS price > 200
)
----

# Test 4: Pattern with date range filter
query TDI
SELECT * FROM stock_price
MATCH_RECOGNIZE (
    ALL ROWS PER MATCH
    PATTERN (A B)
    DEFINE
        A AS price > 100 AND price_date = '2024-01-01',
        B AS price > 100 AND price_date = '2024-01-02'
)
----
DDOG 2024-01-01 125
DDOG 2024-01-02 128
AAPL 2024-01-01 185
AAPL 2024-01-02 187
MSFT 2024-01-01 375
MSFT 2024-01-02 378
GOOGL 2024-01-01 140
GOOGL 2024-01-02 142
AMZN 2024-01-01 150
AMZN 2024-01-02 152
TSLA 2024-01-01 248
TSLA 2024-01-02 251
NVDA 2024-01-01 485
NVDA 2024-01-02 492
META 2024-01-01 335
META 2024-01-02 338
NFLX 2024-01-01 485
NFLX 2024-01-02 488
CRM 2024-01-01 245
CRM 2024-01-02 248

# Test 5: Pattern with complex conditions
query TDI
SELECT * FROM stock_price
MATCH_RECOGNIZE (
    ALL ROWS PER MATCH
    PATTERN (A)
    DEFINE A AS price > 100 AND company = 'DDOG'
)
----
DDOG 2024-01-01 125
DDOG 2024-01-02 128
DDOG 2024-01-03 132
DDOG 2024-01-04 129
DDOG 2024-01-05 135
DDOG 2024-01-08 138
DDOG 2024-01-09 141
DDOG 2024-01-10 139
DDOG 2024-01-11 143
DDOG 2024-01-12 147
