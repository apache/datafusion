# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at

#   http://www.apache.org/licenses/LICENSE-2.0

# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.

# Tests for decimal division operations.
#
# Note: spark_decimal_div and spark_decimal_integral_div are internal functions
# in datafusion-spark intended for use by query planners when Spark-compatible
# decimal division semantics are needed. They provide:
# - Legacy mode: divide by zero returns 0 (not error)
# - Spark-compatible rounding (round half away from zero)
# - BigInt fallback for high precision calculations
#
# These functions are exported from datafusion-spark as:
#   - SparkDecimalDiv
#   - SparkDecimalIntegralDiv
#
# For comprehensive unit tests, see:
#   datafusion/spark/src/function/math/decimal_div.rs
#
# The tests below use DataFusion's native decimal division operator (/)
# to verify basic decimal arithmetic.

# Basic decimal division
query R
SELECT 10.00::decimal(10,2) / 2.00::decimal(10,2);
----
5

query R
SELECT 10.00::decimal(10,2) / 3.00::decimal(10,2);
----
3.333333

# Division by zero returns an error in DataFusion's native division
# (Spark's Legacy mode returns NULL, which spark_decimal_div implements)
query error DataFusion error: Arrow error: Divide by zero error
SELECT 10.00::decimal(10,2) / 0.00::decimal(10,2);

# Negative division
query R
SELECT -10.00::decimal(10,2) / 3.00::decimal(10,2);
----
-3.333333

query R
SELECT 10.00::decimal(10,2) / -3.00::decimal(10,2);
----
-3.333333

# NULL handling
query R
SELECT NULL::decimal(10,2) / 2.00::decimal(10,2);
----
NULL

query R
SELECT 10.00::decimal(10,2) / NULL::decimal(10,2);
----
NULL

# High precision decimals
query R
SELECT 123456789.123456::decimal(20,6) / 9.87654321::decimal(10,8);
----
12499999.89859367

# Small decimals
query R
SELECT 0.001::decimal(10,6) / 0.002::decimal(10,6);
----
0.5

# More rounding tests
query R
SELECT 1.00::decimal(10,2) / 3.00::decimal(10,2);
----
0.333333

query R
SELECT 2.00::decimal(10,2) / 3.00::decimal(10,2);
----
0.666666

# Large value division
query R
SELECT 999999999.99::decimal(20,2) / 1.00::decimal(10,2);
----
999999999.99

# Precision preservation
query R
SELECT 1.00::decimal(10,2) / 7.00::decimal(10,2);
----
0.142857
