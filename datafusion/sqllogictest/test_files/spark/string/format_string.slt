# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at

#   http://www.apache.org/licenses/LICENSE-2.0

# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.

# This file was originally created by a porting script from:
#   https://github.com/lakehq/sail/tree/43b6ed8221de5c4c4adbedbb267ae1351158b43c/crates/sail-spark-connect/tests/gold_data/function
# This file is part of the implementation of the datafusion-spark function library.
# For more information, please see:
#   https://github.com/apache/datafusion/issues/15914

# ================================
# Basic format_string tests
# ================================

## Basic string formatting
query T
SELECT format_string('Hello World %s', 'DataFusion');
----
Hello World DataFusion

## Basic integer formatting
query T
SELECT format_string('Hello World %d %s', 100, 'days');
----
Hello World 100 days

## Multiple string arguments
query T
SELECT format_string('%s %s %s', 'Hello', 'World', 'Test');
----
Hello World Test

## Format without arguments (just return the format string)
query T
SELECT format_string('Hello World');
----
Hello World

# ================================
# Integer formatting tests
# ================================

## Decimal integer formatting
query T
SELECT format_string('Value: %d', 42);
----
Value: 42

## Hexadecimal integer formatting (lowercase)
query T  
SELECT format_string('Hex: %x', 255);
----
Hex: ff

## Hexadecimal integer formatting (uppercase)
query T
SELECT format_string('Hex: %X', 255);
----
Hex: FF

## Octal integer formatting
query T
SELECT format_string('Octal: %o', 64);
----
Octal: 100

## Integer with width padding
query T
SELECT format_string('Padded: %5d', 42);
----
Padded:    42

## Integer with zero padding
query T
SELECT format_string('Zero padded: %05d', 42);
----
Zero padded: 00042

## Left-aligned integer
query T
SELECT format_string('Left: %-5d|', 42);
----
Left: 42   |

## Integer with force sign
query T
SELECT format_string('Signed: %+d', 42);
----
Signed: +42

## Negative integer
query T
SELECT format_string('Negative: %d', -42);
----
Negative: -42

# ================================
# Float formatting tests  
# ================================

## Basic float formatting
query T
SELECT format_string('Float: %f', 3.14159);
----
Float: 3.141590

query T
SELECT format_string('Float: %f', 30.0);
----
Float: 30.000000

## Float with precision
query T
SELECT format_string('Precision: %.2f', 3.14159);
----
Precision: 3.14

## Scientific notation (lowercase)
query T
SELECT format_string('Scientific: %e', 1234.5);
----
Scientific: 1.234500e+03

## Scientific notation (uppercase)
query T
SELECT format_string('Scientific: %E', 1234.5);
----
Scientific: 1.234500E+03

## Compact float (lowercase)
query T
SELECT format_string('Compact: %g', 1234.5);
----
Compact: 1234.5

query T
SELECT format_string('Compact: %g', CAST(123456789.1 AS DOUBLE));
----
Compact: 1.23457e+08

## Compact float (uppercase)
query T
SELECT format_string('Compact: %G', 1234.5);
----
Compact: 1234.5

query T
SELECT format_string('Compact: %G', CAST(123456789.1 AS DOUBLE));
----
Compact: 1.23457E+08

## Float with width and precision
query T
SELECT format_string('Formatted: %10.2f', 3.14159);
----
Formatted:       3.14

## Float zero padding
query T
SELECT format_string('Zero: %08.2f', 3.14);
----
Zero: 00003.14

# ================================
# Boolean formatting tests
# ================================

## Boolean lowercase
query T
SELECT format_string('Bool: %b', true);
----
Bool: true

## Boolean uppercase  
query T
SELECT format_string('Bool: %B', false);
----
Bool: FALSE

## Boolean with width
query T
SELECT format_string('Bool: %6b', true);
----
Bool:   true

# ================================
# String formatting tests
# ================================

## String formatting
query T
SELECT format_string('String: %s', 'DataFusion');
----
String: DataFusion

## String with width
query T
SELECT format_string('Padded: %10s|', 'test');
----
Padded:       test|

## String left-aligned
query T
SELECT format_string('Left: %-10s|', 'test');
----
Left: test      |

## String with precision (truncation)
query T
SELECT format_string('Truncated: %.3s', 'DataFusion');
----
Truncated: Dat

## String uppercase conversion
query T
SELECT format_string('Upper: %S', 'datafusion');
----
Upper: DATAFUSION

# ================================
# Character formatting tests
# ================================

## Character formatting from integer
query T
SELECT format_string('Char: %c', 97);
----
Char: a

## Character uppercase
query T
SELECT format_string('Char: %C', 97);
----
Char: A

# ================================
# Time formatting tests
# ================================

## Hour formatting (24-hour)
query T
SELECT format_string('Hour: %tH', TIMESTAMP '2023-12-25 14:30:45');
----
Hour: 14

## Hour formatting (12-hour)
query T
SELECT format_string('Hour: %tI', TIMESTAMP '2023-12-25 14:30:45');
----
Hour: 02

## Minute formatting
query T
SELECT format_string('Minute: %tM', TIMESTAMP '2023-12-25 14:30:45');
----
Minute: 30

## Second formatting  
query T
SELECT format_string('Second: %tS', TIMESTAMP '2023-12-25 14:30:45');
----
Second: 45

## AM/PM marker
query T
SELECT format_string('AM/PM: %tp', TIMESTAMP '2023-12-25 14:30:45');
----
AM/PM: pm

## Year formatting
query T
SELECT format_string('Year: %tY', TIMESTAMP '2023-12-25 14:30:45');
----
Year: 2023

## Month formatting
query T
SELECT format_string('Month: %tm', TIMESTAMP '2023-12-25 14:30:45');
----
Month: 12

## Day formatting
query T
SELECT format_string('Day: %td', TIMESTAMP '2023-12-25 14:30:45');
----
Day: 25

## Time formatting (HH:MM)
query T
SELECT format_string('Time: %tR', TIMESTAMP '2023-12-25 14:30:45');
----
Time: 14:30

## Time formatting (HH:MM:SS)
query T
SELECT format_string('Time: %tT', TIMESTAMP '2023-12-25 14:30:45');
----
Time: 14:30:45

## Date formatting (MM/DD/YY)
query T
SELECT format_string('Date: %tD', TIMESTAMP '2023-12-25 14:30:45');
----
Date: 12/25/23

## ISO date formatting (YYYY-MM-DD)
query T
SELECT format_string('ISO Date: %tF', TIMESTAMP '2023-12-25 14:30:45');
----
ISO Date: 2023-12-25

## Complex date formatting (Sun Jul 20 16:17:00 EDT 1969)
query B
SELECT format_string('Date: %tc', TIMESTAMP '1969-07-20 16:17:00') LIKE 'Date: Sun Jul 20 16:17:00 % 1969';
----
true


## Hour formatting (24-hour no padding)
query T
SELECT format_string('Hour: %tk', TIMESTAMP '2023-12-25 04:30:45');
----
Hour: 4

## Hour formatting (12-hour no padding)
query T
SELECT format_string('Hour: %tl', TIMESTAMP '2023-12-25 14:30:45');
----
Hour: 2

## Milliseconds formatting
query T
SELECT format_string('Milliseconds: %tL', TIMESTAMP '2023-12-25 14:30:45.123');
----
Milliseconds: 123

## Nanoseconds formatting
query T
SELECT format_string('Nanoseconds: %tN', TIMESTAMP '2023-12-25 14:30:45.123456789');
----
Nanoseconds: 123456789

## Timezone offset (RFC 822)
query T
SELECT format_string('Timezone: %tz', TIMESTAMP '2023-12-25 14:30:45');
----
Timezone: +0000

## Timezone abbreviation
query T
SELECT format_string('Timezone: %tZ', from_unixtime(1599572549, 'America/New_York'));
----
Timezone: UTC

## Seconds since epoch
query T
SELECT format_string('Epoch seconds: %ts', TIMESTAMP '1970-01-01 00:00:01');
----
Epoch seconds: 1

## Milliseconds since epoch
query T
SELECT format_string('Epoch millis: %tQ', TIMESTAMP '1970-01-01 00:00:01');
----
Epoch millis: 1000

## Full month name
query T
SELECT format_string('Month: %tB', TIMESTAMP '2023-12-25 14:30:45');
----
Month: December

## Abbreviated month name
query T
SELECT format_string('Month: %tb', TIMESTAMP '2023-12-25 14:30:45');
----
Month: Dec

## Same as %tb
query T
SELECT format_string('Month: %th', TIMESTAMP '2023-12-25 14:30:45');
----
Month: Dec

## Full day of week
query T
SELECT format_string('Day: %tA', TIMESTAMP '2023-12-25 14:30:45');
----
Day: Monday

## Abbreviated day of week
query T
SELECT format_string('Day: %ta', TIMESTAMP '2023-12-25 14:30:45');
----
Day: Mon

## Century (year/100)
query T
SELECT format_string('Century: %tC', TIMESTAMP '2023-12-25 14:30:45');
----
Century: 20

## Two-digit year
query T
SELECT format_string('Year: %ty', TIMESTAMP '2023-12-25 14:30:45');
----
Year: 23

## Day of year
query T
SELECT format_string('Day of year: %tj', TIMESTAMP '2023-12-25 14:30:45');
----
Day of year: 359

## Day of month (no padding)
query T
SELECT format_string('Day: %te', TIMESTAMP '2023-12-05 14:30:45');
----
Day: 5

## 12-hour time with AM/PM
query T
SELECT format_string('Time: %tr', TIMESTAMP '2023-12-25 14:30:45');
----
Time: 02:30:45 PM


# ================================
# Decimal formatting tests
# ================================

## Decimal formatting
query T
SELECT format_string('Decimal: %f', CAST(123.456 AS DECIMAL(10,3)));
----
Decimal: 123.456000

## Decimal with precision
query T
SELECT format_string('Decimal: %.2f', CAST(123.456 AS DECIMAL(10,3)));
----
Decimal: 123.46

## Decimal scientific notation
query T
SELECT format_string('Scientific: %e', CAST(1234.5 AS DECIMAL(10,2)));
----
Scientific: 1.234500e+03

# ================================
# Special cases and edge cases
# ================================

## Literal percent sign
query T
SELECT format_string('Percent: %%');
----
Percent: %

## Newline character
query T
SELECT format_string('Line1%nLine2');
----
 
01)Line1
02)Line2

## Multiple format specifiers
query T
SELECT format_string('String: %s, Integer: %d, Float: %.2f', 'test', 42, 3.14159);
----
String: test, Integer: 42, Float: 3.14

## Mixed width and precision
query T
SELECT format_string('Mixed: %10s %5d %.2f', 'hello', 123, 45.678);
----
Mixed:      hello   123 45.68

# ================================
# NULL handling tests
# ================================

## NULL format string
query T
SELECT format_string(NULL, 'test');
----
NULL

## NULL argument
query T
SELECT format_string('Value: %s', NULL);
----
Value: null

## Multiple NULL arguments
statement error
SELECT format_string('%s %d %f', NULL, CAST(NULL AS INT), CAST(NULL AS DOUBLE));


# ================================
# Error cases (should fail)
# ================================

## Format string expects arguments but none provided
statement error
SELECT format_string('Value: %d');

## Too few arguments for format specifiers
statement error
SELECT format_string('Values: %d %s', 42);

## Invalid conversion for data type
statement error
SELECT format_string('Value: %d', 'not_a_number');

# ================================
# Positional argument tests
# ================================

## Positional arguments
query T
SELECT format_string('%2$s %1$d', 42, 'test');
----
test 42

## Reuse positional arguments
query T
SELECT format_string('%1$s %1$s', 'repeat');
----
repeat repeat

## Mixed positional and sequential
query T
SELECT format_string('%2$s %s %1$d', 42, 'middle', 'end');
----
middle 42 42

# ================================
# Flag combination tests
# ================================

## Alternate form with hex
query T
SELECT format_string('Hex: %#x', 255);
----
Hex: 0xff

## Alternate form with octal
query T
SELECT format_string('Octal: %#o', 64);
----
Octal: 0100

## Space sign with positive number
query T
SELECT format_string('Space: % d', 42);
----
Space:  42

## Grouping separator (if supported)
query T
SELECT format_string('Grouped: %,d', 1234567);
----
Grouped: 1,234,567

## Parentheses for negative numbers
query T
SELECT format_string('Negative: %(d', -42);
----
Negative: (42)

# ================================
# Array/Column tests
# ================================

## Test with array values
statement ok
CREATE TABLE test_format(fmt STRING, val1 STRING, val2 INT) AS VALUES 
  ('Hello %s %d', 'World', 1),
  ('Float: %2$d %1$s', '3.14159', 2);

query T
SELECT format_string(fmt, val1, val2) FROM test_format;
----
Hello World 1
Float: 2 3.14159

statement ok
DROP TABLE test_format;

# ================================
# General formatting tests (%h, %H)
# ================================

# Not implemented yet. Can be implemented after https://github.com/apache/datafusion/pull/17093 is merged
## Hash value formatting (lowercase)
statement error
SELECT format_string('Hash: %h', 'test');
# ----
# Hash: ec06e15a

## Hash value formatting (uppercase)
statement error
SELECT format_string('Hash: %H', 'test');
# ----
# Hash: EC06E15A

## Hash with width
statement error
SELECT format_string('Hash: %10h', 'test');
# ----
# Hash:   ec06e15a

# ================================
# Hexadecimal floating point tests
# ================================

## Hexadecimal float (lowercase)
query T
SELECT format_string('Hex float: %a', 15.9375);
----
Hex float: 0x1.fep3

## Hexadecimal float (uppercase)
query T
SELECT format_string('Hex float: %A', 15.9375);
----
Hex float: 0X1.FEP3

## Hexadecimal float with precision
query T
SELECT format_string('Hex float: %.10a', 15.9375);
----
Hex float: 0x1.fe00000000p3

query T
SELECT format_string('%a', 12.3456);
----
0x1.8b0f27bb2fec5p3


# ================================
# Relative indexing tests
# ================================

## Relative indexing with <
query T
SELECT format_string('%s %<s %<s', 'repeat');
----
repeat repeat repeat

## Mixed relative and positional indexing
query T
SELECT format_string('%2$s %<s %1$d', 42, 'test');
----
test test 42

# ================================
# Extended flag combination tests
# ================================

## Combine + and 0 flags
query T
SELECT format_string('Signed zero-padded: %+08d', 42);
----
Signed zero-padded: +0000042

## Combine space and width
query T
SELECT format_string('Space padded: % 8d', 42);
----
Space padded:       42

## Combine # flag with float
query T
SELECT format_string('Always decimal: %#.0f', 42.0);
----
Always decimal: 42.

## Combine # flag with float
query T
SELECT format_string('Always decimal: %#.0f', 40.0);
----
Always decimal: 40.

## Combine multiple flags with hex
query T
SELECT format_string('Hex: %#08x', 255);
----
Hex: 0x0000ff

# ================================
# Special numeric values
# ================================

## Float NaN
query T
SELECT format_string('NaN: %f', CAST('NaN' AS DOUBLE));
----
NaN: NaN

## Float positive infinity
query T
SELECT format_string('Infinity: %f', CAST('+Inf' AS DOUBLE));
----
Infinity: Infinity

## Float negative infinity
query T
SELECT format_string('Negative Infinity: %f', CAST('-Inf' AS DOUBLE));
----
Negative Infinity: -Infinity

## Float negative infinity with parentheses
query T
SELECT format_string('Negative Infinity: %(f', CAST('-Inf' AS DOUBLE));
----
Negative Infinity: (Infinity)

# ================================
# Large number tests
# ================================

## Large integer
query T
SELECT format_string('Large: %d', 9223372036854775807);
----
Large: 9223372036854775807

## Very large integer with grouping
query T
SELECT format_string('Grouped large: %,d', 9223372036854775807);
----
Grouped large: 9,223,372,036,854,775,807

# ================================
# Precision edge cases
# ================================

## Zero precision with decimal
query T
SELECT format_string('Zero precision: %.0f', 3.14159);
----
Zero precision: 3

## High precision float
query T
SELECT format_string('High precision: %.10f', 3.14159);
----
High precision: 3.1415900000

## Scientific notation with precision
query T
SELECT format_string('Scientific: %.3e', 1234.56789);
----
Scientific: 1.235e+03

# ================================
# Width edge cases
# ================================

## Very wide formatting
query T
SELECT format_string('Wide: %20s|', 'test');
----
Wide:                 test|

## Wide with left alignment
query T
SELECT format_string('Wide left: %-20s|', 'test');
----
Wide left: test                |

# ================================
# Character encoding tests
# ================================

## Unicode character
query T
SELECT format_string('Unicode: %c', 8364);
----
Unicode: €

## High Unicode codepoint
query T
SELECT format_string('Emoji: %c', 128512);
----
Emoji: 😀

# ================================
# Advanced error cases
# ================================

## Invalid flag combination (+ and space)
statement error
SELECT format_string('%+ d', 42);

## Invalid flag combination (- and 0)
statement error
SELECT format_string('%-0d', 42);

## Width without value for line separator
statement error
SELECT format_string('%5n');

# ================================
# BigInteger-like tests
# ================================

## Very large number in different bases
query T
SELECT format_string('Large hex: %x', 9223372036854775807::BIGINT);
----
Large hex: 7fffffffffffffff

## Large octal
query T
SELECT format_string('Large octal: %o', 9223372036854775807::BIGINT);
----
Large octal: 777777777777777777777
