# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at

# http://www.apache.org/licenses/LICENSE-2.0

# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.

###
## Setup test for postgres
###

onlyif postgres
statement ok
CREATE TABLE aggregate_test_100_by_sql
(
    c1  character varying NOT NULL,
    c2  smallint          NOT NULL,
    c3  smallint          NOT NULL,
    c4  smallint,
    c5  integer,
    c6  bigint            NOT NULL,
    c7  smallint          NOT NULL,
    c8  integer           NOT NULL,
    c9  bigint            NOT NULL,
    c10 character varying NOT NULL,
    c11 real              NOT NULL,
    c12 double precision  NOT NULL,
    c13 character varying NOT NULL
);

# Copy the data
onlyif postgres
statement ok
COPY aggregate_test_100_by_sql
    FROM '../../testing/data/csv/aggregate_test_100.csv'
    DELIMITER ','
    CSV HEADER;

###
## Setup test for datafusion
###
skipif postgres
statement ok
CREATE EXTERNAL TABLE aggregate_test_100_by_sql (
  c1  VARCHAR NOT NULL,
  c2  TINYINT NOT NULL,
  c3  SMALLINT NOT NULL,
  c4  SMALLINT,
  c5  INT,
  c6  BIGINT NOT NULL,
  c7  SMALLINT NOT NULL,
  c8  INT NOT NULL,
  c9  BIGINT UNSIGNED NOT NULL,
  c10 VARCHAR NOT NULL,
  c11 FLOAT NOT NULL,
  c12 DOUBLE NOT NULL,
  c13 VARCHAR NOT NULL
)
STORED AS CSV
LOCATION '../../testing/data/csv/aggregate_test_100.csv'
OPTIONS ('format.has_header' 'true');




query RRRRR
SELECT
  abs(-1.1) as abs,
  exp(2.0) as exp,
  sin(3.0) as sin,
  cos(4.0) as cos,
  tan(5.0) as tan;
----
1.1 7.389056098931 0.14112000806 -0.653643620864 -3.380515006247


query I
select length('aÌˆ');
----
2


query I
SELECT 1 as num;
----
1


query IIT
SELECT
  c2,
  c3,
  c10
FROM aggregate_test_100_by_sql
ORDER BY c2 ASC, c3 DESC, c10;
----


query IIT
SELECT
    c5,
    c4,
    c10
FROM aggregate_test_100_by_sql
ORDER BY c5 ASC, c4 DESC, c10;
----


query IRII rowsort
SELECT * FROM
(VALUES (1,2.0,-3,1+1),(10,20.0,-30,2+2))
AS tbl(int_col, float_col, negative_col, summation);
----
1 2 -3 2
10 20 -30 4


query IIRIIIIII
SELECT
  count(*) AS count_all,
  count(c3) AS count_c3,
  avg(c3) AS avg,
  sum(c3) AS sum,
  max(c3) AS max,
  min(c3) AS min,
  bit_and(c3) as bit_and,
  bit_or(c3) as bit_or,
  bit_xor(c3) as bit_xor
FROM aggregate_test_100_by_sql;
----
0 0 NULL NULL NULL NULL NULL NULL NULL


query IIRIIIIII
select
  c2,
  sum(c3) sum_c3,
  avg(c3) avg_c3,
  max(c3) max_c3,
  min(c3) min_c3,
  count(c3) count_c3,
  bit_and(c3) bit_and_c3,
  bit_or(c3) bit_or_c3,
  bit_xor(c3) bit_xor_c3
from aggregate_test_100_by_sql
group by c2
order by c2;
----


query I
SELECT
  t1.c9 result
FROM aggregate_test_100_by_sql t1
INNER JOIN aggregate_test_100_by_sql t2
ON t1.c9 = t2.c9
ORDER BY result;
----


query TIIIIIIIITRRT
select * from aggregate_test_100_by_sql
order by c1, c2, c3, c4, c5, c6, c7, c8, c9, c10, c11, c12, c13;
----

# distinct_from logic for floats
query BBBBBBBBBBB
select 
    'nan'::float is distinct from 'nan'::float v7,
    'nan'::float is not distinct from 'nan'::float v8,
    'nan'::float is not distinct from null v9,
    'nan'::float is distinct from null v10,
    null is distinct from 'nan'::float v11,
    null is not distinct from 'nan'::float v12,
    1::float is distinct from 2::float v13,
    'nan'::float is distinct from 1::float v14,
    'nan'::float is not distinct from 1::float v15,
    1::float is not distinct from null v16,
    1::float is distinct from null v17
;
----
false true false true true false true true false false true

########
# Clean up after the test
########
statement ok
DROP TABLE aggregate_test_100_by_sql


statement ok
CREATE TABLE empty_table (
  c1  TEXT,
  c2  INT
);


query TI
select * from empty_table;
----
